FROM node:lts-alpine as builder

ARG version=2.4.2

RUN apk add --no-cache git python3 make g++

WORKDIR /zone-mta

RUN git clone --depth 1 https://github.com/AvapnoHelpingHand/zone-mta ./

RUN npm install --production


FROM node:lts-alpine as app

ENV NODE_ENV production

RUN apk add --no-cache tini

WORKDIR /zone-mta
COPY --from=builder /zone-mta /zone-mta

ENTRYPOINT ["/sbin/tini", "--", "node", "app.js"]
CMD ["--config=config/zonemta.toml"]